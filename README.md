# Description

Detects newly installed applications on your endpoints by using the "Discovered apps" list that's generated by the Intune Management Extension. 

# How it works

deploy.ps1 creates the appropriate resources in Azure and deploys the code to an Azure Function App that's configured with a timer trigger set to 15:00 UTC. The code then:

1. Fetches the Detected apps list for all endpoints from MS Graph's /deviceManagement/detectedApps endpoint.
2. Saves the list to CSV in an Azure Storage container.
3. Retrieves the most recent previous Detected apps list from the same container. The list must be less than or equal to 1 day old.
4. Generates a diff of the two files. If there are results, save them to a 2nd container in Azure.
5. If it's $REPORT_DAY_OF_WEEK, fetch the prior $DAYS_TO_AGGREGATE days of diff results. Aggregate them and fetch a list of hostnames for each app from /deviceManagement/detectedApps/$appId/managedDevices.
6. Email the results and prune CSVs older than $RETENTION_PERIOD.

# Why?

I created this tool to satisfy control 2.4 "Utilize Automated Software Inventory Tools" in the CIS 18 framework. 

# Usage

Run deploy.ps1. You will be prompted for configuration variables during script execution.

# Troubleshooting

Azure Functions Core Tools doesn't always like authenticating via the Azure Powershell SDK. If you get an error from the func publish command, try installing the [Azure CLI](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest), authenticating via "az login," and executing the func publish command on line 143 of deploy.ps1 again.

